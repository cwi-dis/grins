#!/bin/sh
# Common code for cmifed and cmifplay. Set
# $function set to "editor" or "player"
#
function=editor

case `uname -sr` in
IRIX\ 5.*)	ARCH=irix5;;
IRIX\ 6.*)	ARCH=irix6;;
SunOS\ 5.*)	ARCH=sunos5;;
*)		echo "$0: unknown architecture" >&2; exit 1;;
esac

prog="$0"
case "$prog" in
*/*)	dir=`dirname "$prog"`;;
*)	IFS=:
	for dir in $PATH
	do
		[ -x "${dir:-.}/$prog" ] && break
	done
	dir="${dir:-.}"
	;;
esac
IFS=' 	
'
case "$dir" in
/*)	;;
*)	dir=`pwd`/$dir;;
esac

while :
do
	case "$dir" in
	*/.)	dir=`dirname "$dir"`;;
	*)	break;;
	esac
done

case "$dir" in
*/bin)	dir=`dirname "$dir"`;;
esac

for sub in $function common video python lib mmpython
do
	if [ ! -d "$dir/$sub" ]
	then
		echo "$0: cannot find proper directory" >&2
		exit 1
	fi
done

python="$dir/mmpython/$ARCH/python"
pythonsrc="$dir/python"
pythonlib="$pythonsrc/Lib"

CMIF="$dir"
export CMIF

PYTHONPATH=$CMIF/$function
PYTHONPATH=$PYTHONPATH:$CMIF/common
PYTHONPATH=$PYTHONPATH:$CMIF/lib
PYTHONPATH=$PYTHONPATH:$CMIF/video
if [ -d $CMIF/pylib ]
then
	for dir in `find $CMIF/pylib -type d ! -name CVS -print`
	do
		PYTHONPATH=$PYTHONPATH:$dir
	done
fi

PYTHONPATH=$PYTHONPATH:$pythonlib
PYTHONPATH=$PYTHONPATH:$pythonlib/test
PYTHONPATH=$PYTHONPATH:$pythonlib/$ARCH
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/X11/Lib
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/img/Lib
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/midi/Lib

export PYTHONPATH

# Is this still needed?

CMIF_USE_X=1
export CMIF_USE_X

PATH="$PATH:$dir/demo/amsterdam"
export PATH

exec $python -c "import main" ${1+"$@"}
