#!/bin/sh
# Common code for cmifed, grins and cmifplay.
#
# Set $function to "editor", "grins" or "player"
#

prog="$0"

case $prog in
*grins)	function=grins;;
*play)	function=player;;
*)	function=editor;;
esac

case `uname -sr` in
IRIX\ 6.3)	ARCH=irix6;;
IRIX\ [56].*)	ARCH=irix5;;
SunOS\ 5.*)	ARCH=sunos5;;
*)		echo "$0: unknown architecture" >&2; exit 1;;
esac

case "$prog" in
*/*)	dir=`dirname "$prog"`;;
*)	IFS=:
	for dir in $PATH
	do
		[ -x "${dir:-.}/$prog" ] && break
	done
	dir="${dir:-.}"
	;;
esac
IFS=' 	
'
case "$dir" in
/*)	;;
*)	dir=`pwd`/$dir;;
esac

while :
do
	case "$dir" in
	*/.)	dir=`dirname "$dir"`;;
	*)	break;;
	esac
done

case "$dir" in
*/bin)	dir=`dirname "$dir"`;;
esac

for sub in $function common video python lib mmpython
do
	if [ ! -d "$dir/$sub" ]
	then
		echo "$0: cannot find proper directory" >&2
		exit 1
	fi
done

python="$dir/mmpython/$ARCH/python"
pythonsrc="$dir/python"
pythonlib="$pythonsrc/Lib"

CMIF="$dir"
export CMIF

PYTHONPATH=$CMIF/$function
PYTHONPATH=$PYTHONPATH:$CMIF/common
PYTHONPATH=$PYTHONPATH:$CMIF/lib
PYTHONPATH=$PYTHONPATH:$CMIF/video
if [ -d $CMIF/pylib ]
then
	for dir in `find $CMIF/pylib -type d ! -name CVS -print`
	do
		PYTHONPATH=$PYTHONPATH:$dir
	done
fi

PYTHONPATH=$PYTHONPATH:$pythonlib
PYTHONPATH=$PYTHONPATH:$pythonlib/test
PYTHONPATH=$PYTHONPATH:$pythonlib/plat-$ARCH
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/X11/Lib
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/img/Lib
PYTHONPATH=$PYTHONPATH:$pythonsrc/Extensions/midi/Lib

export PYTHONPATH

# Is this still needed?

CMIF_USE_X=1
export CMIF_USE_X

PATH="$PATH:$dir/demo/amsterdam"
export PATH

options=
while :
do
	[ $# -lt 1 ] && break
	case "$1" in
	-*)	options="$options $1"; shift;;
	*)	break;;
	esac
done
    
exec $python $options -c "import main" ${1+"$@"}
